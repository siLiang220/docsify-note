
## 索引的概念

索引（Index）是帮助 MySQL 高效获取数据的数据结构，可以简单理解为**排好序的快速查找数据结构**

在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构上实现高级查找算法。这种数据结构，就是索引

![](https://zhaosi-1253759587.cos.ap-nanjing.myqcloud.com/files/obsidian/picture/uTools_1670059387075.png)

左边是数据表，一共有两列七条记录，最左边的是数据记录的物理地址（注意逻辑上相邻的记录在磁盘上也并不是一定物理相邻的）。为了加快Col2的查找，可以维护一个右边所示的二叉查找树，每个节点分别包含索引键值和一个指向对应数据记录物理地址的指针，这样就可以运用二叉查找快速获取到相应数据。

一般来说索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储在磁盘上。索引是数据库中用来提高性能的最常用的工具。

## 索引的优缺点

### 优势：
-  提高数据检索的效率，降低数据库的IO成本。
-  数据排序，降低CPU消耗。

### 劣势：

-   虽然索引大大提高了查询速度，同时却会降低更新表的速度
    
    如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件每次更新添加了索引列的字段，都会调整因更新所带来的键值变化后的索引信息。
    
-   索引本质也是一张表，保存着索引字段和指向实际记录的指针，所以也要占用数据库空间，一般而言，索引表占用的空间是数据表的1.5倍

## 索引的分类

### 单值索引
概念：**即一个索引只包含单个列，一个表可以有多个单列索引**

- 所表一起创建
```sql
CREATE TABLE customer (
  id INT (10) UNSIGNED AUTO_INCREMENT,
  customer_no VARCHAR (200),
  customer_name VARCHAR (200),
  PRIMARY KEY (id),
  KEY (customer_name)	#this
);
```

- 单独建单值索引
```sql
CREATE INDEX idx_customer_name
ON customer (customer_name);
```

### 唯一索引

概念：**索引列的值必须唯一，但允许有空值**

- 随表一起创建
```sql
CREATE TABLE customer (
  id INT (10) UNSIGNED AUTO_INCREMENT,
  customer_no VARCHAR (200),
  customer_name VARCHAR (200),
  PRIMARY KEY (id),
  KEY (customer_name),
  UNIQUE (customer_no)	#this
);
```

- 单独建唯一索引
```sql
CREATE UNIQUE INDEX idx_customer_no
ON customer (customer_no);
```

### 复合索引
概念：**即一个索引包含多个列**
- 随表一起建索引
```sql
CREATE TABLE customer (
  id INT (10) UNSIGNED AUTO_INCREMENT,
  customer_no VARCHAR (200),
  customer_name VARCHAR (200),
  PRIMARY KEY (id),
  KEY (customer_name),
  UNIQUE (customer_name),
  KEY (customer_no, customer_name)	#this
);
```
- 单独建索引
```sql
CREATE INDEX idx_no_name
ON customer (customer_no, customer_name);
```

### 主键索引
概念：**设定为主键后数据库自动建立索引，innodb为聚簇索引**
- 随表一起建索引
```sql
CREATE TABLE customer (
  id INT (10) UNSIGNED AUTO_INCREMENT,
  customer_no VARCHAR (200),
  customer_name VARCHAR (200),
  PRIMARY KEY (id)	#this
);
```

- 单独建主键索引：
```sql
ALTER TABLE customer ADD PRIMARY KEY customer(customer_no);
```

- 删除主键索引

	必须先删除掉(drop)原索引，再新建(add)索引

### 索引基本语法

### 索引设计原则

索引的设计可以遵循一些已有的原则，创建索引的时候请尽量考虑符合这些原则，便于提升索引的使用效率，更高效的使用索引。

-   对查询频次较高，且数据量比较大的表建立索引。
-  索引字段的选择，最佳候选列应当从where子句的条件中提取，如果where子句中的组合比较多，那么应当挑选最常用、过滤效果最好的列的组合。
-  使用唯一索引，区分度越高，使用索引的效率越高。
-   索引可以有效的提升查询数据的效率，但索引数量不是多多益善，索引越多，维护索引的代价自然也就水涨船高。对于插入、更新、删除等DML操作比较频繁的表来说，索引过多，会引入相当高的维护代价，降低DML操作的效率，增加相应操作的时间消耗。另外索引过多的话，MySQL也会犯选择困难病，虽然最终仍然会找到一个可用的索引，但无疑提高了选择的代价。
- 利用最左前缀，N个列组合而成的组合索引，那么相当于是创建了N个索引，如果查询时where子句中使用了组成该索引的前几个字段，那么这条查询SQL可以利用组合索引来提升查询效率。
创建复合索引
```sql
CREATE INDEX idx_name_email_status ON tb_seller(NAME,email,STATUS);

```

就相当于

对 name 创建索引 ; 对 name , email 创建了索引 ;  对 name , email, status 创建了索引 ;

#### 不适合创建索引的情况
-   表记录太少
-   经常增删改的表或者字段
-   Where 条件里用不到的字段不创建索引
-   过滤性不好的不适合建索引
